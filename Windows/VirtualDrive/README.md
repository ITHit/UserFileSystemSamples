
<h1 class="d-xl-block d-none">Virtual Drive Sample in .NET, C#</h1>
<p>This is a virtual drive implementation with Microsoft Office documents editing support and automatic Microsoft Office documents locking. It also demonstrates custom column support in Windows File Manager.&nbsp;To simulate the remote storage, this sample is using a folder in the local file system on the same machine.&nbsp;This sample supports all basic synchronization features provided that is provided by the <a title="Virtual File System Sample for Windows" href="https://www.userfilesystem.com/examples/virtual_file_system/">Virtual File System</a> sample: folders&nbsp;on-demand listing, files on-demand content loading, selective offline files support, hydration progress. The sample is written in C#/.NET.</p>
<p><span>You can download this sample and a trial license in the&nbsp;</span><a title="Download" href="https://www.userfilesystem.com/download/">product download area</a>&nbsp;as well as you can clone it from<span>&nbsp;</span><a title="Virtual Drive Sample in .NET, C#" href="https://github.com/ITHit/UserFileSystemSamples/tree/master/Windows/VirtualDrive">GitHub</a><span>.&nbsp;</span></p>
<p><span class="warn">This sample is provided with IT Hit User File System v3 Beta and later versions.</span></p>
<h2 class="heading-link" id="nav_requirements">Requirements<a class="list-link d-inline" href="https://www.userfilesystem.com/examples/virtual_file_system/#nav_requirements"></a></h2>
<ul>
<li>.NET Core 3.1 or later.</li>
<li>Microsoft Windows 10 Creators Update or later version.</li>
<li>NTFS file system.</li>
</ul>
<h2 class="heading-link" id="nav_configuringthesample">Configuring the Sample<a class="list-link d-inline" href="https://www.userfilesystem.com/examples/virtual_file_system/#nav_configuringthesample"></a></h2>
<p>By default, the sample will use the&nbsp;<span class="code">\RemoteStorage\</span>&nbsp;folder, located under the project root, to simulate the remote storage file structure. It will mount the user file system under the&nbsp;<span class="code">%USERPROFILE%\VFS\</span>&nbsp;folder (typically&nbsp;<span class="code">C:\Users\&lt;username&gt;\VirtualDrive\</span>).</p>
<p>To specify the folder that will be used for remote storage simulation edit the&nbsp;<span class="code">"RemoteStorageRootPath"</span>&nbsp;parameter in&nbsp;<span class="code">appsettings.json</span>. This could be either an absolute path or a path relative to the application root.</p>
<p>To specify the user file system folder edit the&nbsp;<span class="code">"UserFileSystemRootPath"</span>&nbsp;parameter&nbsp;in&nbsp;<span class="code">appsettings.json</span>.</p>
<h2 class="heading-link" id="nav_settingthelicense">Setting the License<a class="list-link d-inline" href="https://www.userfilesystem.com/examples/virtual_file_system/#nav_settingthelicense"></a></h2>
<p>To run the example, you will need a valid IT Hit User File System Engine for .NET License. You can download the license in&nbsp;the&nbsp;<a title="IT Hit User File System for .NET Download" href="https://www.userfilesystem.com/download/">product download area</a>.&nbsp;Note that the Engine is fully functional with a trial license and does not have any limitations. The trial license is valid for one month and the engine will stop working after this. You can check the expiration date inside the license file.&nbsp;Download the license file and specify its content in&nbsp;<span class="code">License</span>&nbsp;field in&nbsp;<span class="code">appsettings.json</span>&nbsp;file.</p>
<p>You can also run the sample&nbsp;without explicitly specifying a license&nbsp;for 5 days. In this case,&nbsp;the&nbsp;Engine will automatically request the trial license from the IT Hit website https://www.userfilesystem.com. Make sure it is accessible via firewalls if any. After 5 days the Engine will stop working. To extend the trial period you will need to download a license in a&nbsp;<a title="IT Hit User File System for .NET Download" href="https://www.userfilesystem.com/download/">product download area</a>&nbsp;and specify it in&nbsp;<span class="code">appsettings.json</span></p>
<h2 class="heading-link" id="nav_runningthesample">Running the Sample<a class="list-link d-inline" href="https://www.userfilesystem.com/examples/virtual_file_system/#nav_runningthesample"></a></h2>
<p>To run the sample open the project in Visual Studio and run the project in a debug mode. When starting in the debug mode, it will automatically create a folder in which the virtual file system will reside, register the virtual drive with the platform and then open&nbsp;two instances of Windows File Manager, one of which will show a virtual drive and another a folder simulating remote storage.&nbsp;</p>
<p>You can find more about running and stopping the sample as well as about basic synchronization features in the&nbsp;<a title="Virtual File System Sample for Windows" href="https://www.userfilesystem.com/examples/virtual_file_system/">Virtual File System</a>&nbsp;sample description.&nbsp;</p>
<h2>Microsoft Office Editing Support</h2>
<p>The major difference between the Virtual Drive sample and the <a title="Virtual File System Sample for Windows" href="https://www.userfilesystem.com/examples/virtual_file_system/">Virtual File System</a> sample is its support for Microsoft Office Documents editing. This sample<span>&nbsp;supports synchronization of the MS Office documents, avoiding the creation of the temporary files in the remote storage as well as it does not rename or delete the document in your remote storage during MS Office transactional save operation, preserving all data associated with a file in your remote storage.</span></p>
<p><span>This sample automatically locks the Microsoft Office document in the remote storage when a document is being opened for editing and automatically unlocks the document when the file is closed. When the document is opened you will see the lock icon&nbsp;<img id="__mcenew" alt="Lock icon" src="https://www.userfilesystem.com/media/2071/locked.png" rel="120785"> in the Status column in Windows File Manager:</span></p>
<p><span>&nbsp;<img id="__mcenew" alt="Virtual Drive sample shows lock icon for Microsoft Office documents" src="https://www.userfilesystem.com/media/2133/virtualdrivemsoffice.png" rel="122441"></span></p>
<p><span>The information about the lock (lock-token, etc.) is being saved on the client machine when the document is locked.</span>&nbsp;When a document is modified on the client,&nbsp;all changes to the document are being saved on the local drive, without being sent to the remote storage. You will see the not In-Sync icon&nbsp;<img id="__mcenew" alt="" src="https://www.userfilesystem.com/media/1987/notinsyncfile.png" rel="118450"> being displayed when you modify and save the document. The updated document content is sent to the remote storage when the document is closed, together with the lock-token and eTag.&nbsp;</p>
<p>This sample provides classes for storing and managing lock information received from your remote storage and a code template for supplying the lock-token with each update operation, Windows File Manager icons updates, and Windows File Manager custom properties update.&nbsp;Locks, eTags, and custom properties are being stored in the application data folder, under the path that corresponds to the mounted virtual drive. The path to the data folder typically looks like:&nbsp;<span class="code">C:\Users\&lt;user&gt;\AppData\Local\Virtual Drive\C\Users\&lt;user&gt;\VirtualDrive\ServerData\</span></p>
<p>Any temporary Microsoft Office documents (~$docfile.docx, G57BURP.tmp, etc) are stored in the local file system only and are NOT synchronized to the server. Temporary Microsoft Office documents are being automatically deleted by Microsoft office when the document editing is completed.</p>
<h2>Window File Manger Custom Columns Support</h2>
<p><span>This sample registers and displays custom columns in Windows File Manager. For demo purposes the Registrar class add ETag column as well as columns that show information about the lock: Lock Owner, Lock Scope, Lock Expires:</span></p>
<p><span>&nbsp;&nbsp;<img id="__mcenew" alt="Virtual Drive custom columns being displayed in Windows File Manger" src="https://www.userfilesystem.com/media/2132/customcolumnswindowsfilemanager.png" rel="122440"></span></p>
<h3 class="para d-inline next-article-heading">Next Article:</h3>
<a title="WebDAV Drive Sample in .NET, C#" href="https://www.userfilesystem.com/examples/webdav_drive/">WebDAV Drive Sample in .NET, C#</a>

